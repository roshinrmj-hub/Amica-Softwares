<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amica Soft - Interactive Learning</title>
    <style>
        /* --- 1. GLOBAL THEME & VARIABLES --- */
        :root {
            /* Palette */
            --primary: #FF6B6B;      /* Soft Red */
            --secondary: #4ECDC4;    /* Teal */
            --accent: #FFE66D;       /* Yellow */
            --dark: #292f36;         /* Dark Grey */
            --light: #f7f9fc;        /* Light Grey/Blue */
            --white: #ffffff;
            --orange: #FF9F1C;       /* Added for highlights */
            
            /* Typography */
            --font-formal: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-fun: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-formal);
            background-color: var(--light);
            color: #333;
            overflow-x: hidden;
            padding-top: 70px; /* Space for fixed navbar */
        }

        /* --- LOGIN SCREEN STYLES --- */
        #login-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100vh;
            background: rgba(247, 249, 252, 0.98);
            backdrop-filter: blur(10px);
            z-index: 20000; 
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            border-top: 6px solid var(--secondary);
            animation: slideDown 0.5s ease-out;
        }

        .login-title { color: var(--dark); margin-bottom: 5px; font-size: 2rem; }
        .login-subtitle { color: #777; margin-bottom: 30px; }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark); font-size: 0.9rem; }

        .login-input {
            width: 100%; padding: 12px 15px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; transition: border-color 0.3s; outline: none;
        }
        .login-input:focus { border-color: var(--secondary); }

        .btn-login {
            background: var(--primary); color: white; border: none; width: 100%; padding: 12px; font-size: 1.1rem; border-radius: 25px; cursor: pointer; font-weight: bold; transition: background 0.3s, transform 0.1s; box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
        }
        .btn-login:hover { background: #ff5252; }
        .btn-login:active { transform: scale(0.98); }

        .error-msg { color: var(--primary); margin-top: 15px; font-size: 0.9rem; font-weight: bold; min-height: 20px; display: none; }

        @keyframes slideDown { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        .shake-anim { animation: shake 0.3s; }

        /* --- 2. MAIN NAVIGATION --- */
        .site-header {
            position: fixed; top: 0; left: 0; right: 0; height: 70px;
            background: var(--white); box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 5%; z-index: 10000;
        }

        .brand-logo { font-size: 1.6rem; font-weight: 800; color: var(--dark); text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .brand-logo span { color: var(--secondary); }

        .nav-right { display: flex; align-items: center; gap: 20px; }
        .main-nav { display: flex; gap: 25px; }

        .nav-link { text-decoration: none; color: #555; font-weight: 600; font-size: 1rem; transition: color 0.3s; cursor: pointer; padding: 8px 12px; border-radius: 5px; }
        .nav-link:hover, .nav-link.active-link { color: var(--secondary); background: rgba(78, 205, 196, 0.1); }
        .btn-cta { background: var(--primary); color: white !important; border-radius: 25px; padding: 8px 20px; }
        .btn-cta:hover { background: #ff5252; box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3); }

        /* --- USER PROFILE BOX (HEADER) --- */
        #user-profile-box {
            display: none; /* Hidden by default */
            align-items: center;
            gap: 10px;
            padding: 5px 5px 5px 15px;
            background: #f0f4f8;
            border-radius: 30px;
            border: 1px solid #e1e1e1;
        }
        .user-icon { font-size: 1.2rem; }
        .user-name-text { font-weight: bold; color: var(--dark); font-size: 0.95rem; }
        
        .btn-logout {
            background: var(--primary);
            color: white;
            border: none;
            width: 32px; height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .btn-logout:hover { background: #d32f2f; transform: scale(1.1); }

        /* --- 3. PAGE SECTIONS & TRANSITIONS --- */
        .page-section { display: none; min-height: 90vh; padding: 40px 20px; animation: fadeInSection 0.6s ease-out; }
        .page-section.active-section { display: block; }
        @keyframes fadeInSection { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 4. HOME PAGE STYLES --- */
        .hero { text-align: center; max-width: 900px; margin: 40px auto; padding: 0 20px; }
        .hero h1 { font-size: 3.5rem; color: var(--dark); margin-bottom: 10px; line-height: 1.2; }
        .hero .tagline { font-size: 1.5rem; color: var(--secondary); font-weight: 500; margin-bottom: 40px; letter-spacing: 1px; }

        .bridge-container { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 20px; margin: 60px 0; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .bridge-pillar { flex: 1; min-width: 250px; text-align: center; padding: 20px; }
        .bridge-icon { font-size: 3rem; margin-bottom: 15px; display: block; }
        .pillar-title { font-weight: bold; font-size: 1.2rem; color: var(--dark); margin-bottom: 10px; }
        .pillar-desc { color: #666; font-size: 0.95rem; line-height: 1.5; }
        .bridge-center { background: linear-gradient(135deg, var(--secondary), #3aa8a0); color: white; border-radius: 15px; transform: scale(1.05); box-shadow: 0 10px 25px rgba(78, 205, 196, 0.4); }
        .bridge-center .pillar-title { color: white; } .bridge-center .pillar-desc { color: rgba(255,255,255,0.9); }

        /* --- 5. CONTENT STYLES (About, Contact) --- */
        .about-container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); overflow: hidden; }
        .about-header { background: var(--dark); color: white; padding: 40px; text-align: center; }
        .about-content { padding: 50px; line-height: 1.8; font-size: 1.1rem; color: #444; text-align: justify; }
        .about-content h3 { color: var(--primary); margin-top: 30px; font-size: 1.4rem; }
        .quote-box { background: #fff8e1; border-left: 5px solid var(--accent); padding: 20px; margin: 30px 0; font-style: italic; color: #555; }
        
        .contact-card { max-width: 600px; margin: 50px auto; background: white; padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border-top: 6px solid var(--primary); }
        .contact-item { margin: 25px 0; display: flex; align-items: center; justify-content: center; gap: 15px; font-size: 1.2rem; color: var(--dark); }
        .icon-circle { width: 50px; height: 50px; background: var(--light); color: var(--secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }

        /* --- 6. GAME MODULES STYLES --- */
        #app-interface { font-family: var(--font-fun); text-align: center; max-width: 1000px; margin: 0 auto; }
        .brand-footer { position: fixed; bottom: 10px; right: 15px; font-size: 0.9rem; color: #555; background: rgba(255, 255, 255, 0.95); padding: 8px 15px; border-radius: 20px; pointer-events: none; z-index: 9999; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid #ddd; }
        
        .app-nav { background: white; padding: 10px; border-radius: 50px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: inline-flex; gap: 5px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        .app-btn { background: #eee; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; font-weight: bold; color: #555; transition: all 0.2s; font-family: var(--font-fun); }
        .app-btn:hover { background: #ddd; }
        .app-btn.active { background: var(--secondary); color: white; box-shadow: 0 4px 10px rgba(78, 205, 196, 0.4); }

        .score-panel { background: #292f36; color: white; padding: 10px 20px; border-radius: 15px; margin: 0 auto 20px auto; display: inline-flex; align-items: center; gap: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border-bottom: 4px solid #1a1e22; }
        .score-text { font-size: 1.2rem; font-weight: bold; }
        .score-val { color: var(--accent); font-size: 1.4rem; }
        .btn-reset { background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-family: var(--font-fun); font-weight: bold;}

        .module-container { display: none; background: white; max-width: 850px; margin: 0 auto; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); animation: fadeIn 0.4s ease-out; border-top: 6px solid var(--secondary); margin-bottom: 50px; }
        .module-container.active-module { display: block; }
        h2.module-title { color: var(--dark); margin-top: 0; font-size: 2rem; }
        .story-text { font-size: 1.3rem; color: #555; margin: 15px 0; font-style: italic; background: #fff8e1; padding: 15px; border-radius: 10px; border-left: 5px solid var(--accent); }
        .equation { font-size: 2.5rem; color: #333; margin: 20px 0; font-weight: bold; }
        
        .controls { margin: 20px 0; display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap; }
        .btn-action { background: var(--secondary); color: white; border: none; padding: 12px 25px; border-radius: 12px; font-size: 1.1rem; cursor: pointer; font-family: var(--font-fun); box-shadow: 0 4px 0 #3aa8a0; transition: transform 0.1s; }
        .btn-action:active { transform: translateY(4px); box-shadow: 0 0 0 #3aa8a0; }
        .btn-new { background: #FF9F1C; box-shadow: 0 4px 0 #e08e1a; }
        .btn-new:active { box-shadow: 0 0 0 #e08e1a; }
        input.game-input { padding: 10px; width: 100px; text-align: center; font-size: 1.2rem; border-radius: 10px; border: 3px solid #ddd; outline: none; font-family: var(--font-fun); }
        input.game-input:focus { border-color: var(--secondary); }
        .feedback { font-weight: bold; font-size: 1.4rem; margin-top: 15px; min-height: 30px; }
        .correct { color: green; } .wrong { color: var(--primary); }

        /* Game Props */
        .kg-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; min-height: 150px; align-items: center; margin: 20px 0; }
        .kg-item { font-size: 4rem; cursor: pointer; transition: transform 0.2s; user-select: none; }
        .kg-options { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        .kg-btn { width: 60px; height: 60px; border-radius: 50%; border: none; background: #eee; font-size: 1.5rem; font-weight: bold; color: #555; cursor: pointer; box-shadow: 0 4px 0 #ccc; transition: all 0.1s; font-family: var(--font-fun); }
        .kg-btn.correct-choice { background: #4ECDC4; color: white; box-shadow: 0 4px 0 #3aa8a0; }
        .kg-btn.wrong-choice { background: #FF6B6B; color: white; box-shadow: 0 4px 0 #c0392b; }
        .fruit-stage { display: flex; justify-content: center; gap: 10px; font-size: 2em; align-items: center; min-height: 120px; flex-wrap: wrap;}
        .apple { width: 50px; height: 50px; background: var(--primary); border-radius: 50%; display: inline-block; margin: 5px; position: relative; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); }
        .apple::after { content: ''; position: absolute; top: -6px; left: 20px; width: 10px; height: 14px; background: green; border-radius: 5px 0 5px 0; }
        .apple.eaten { opacity: 0.5; filter: grayscale(100%); }
        .apple.eaten .cross-line { position: absolute; top: 5px; left: 22px; width: 6px; height: 40px; background: red; transform: rotate(-45deg); }
        .grouping-stage { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin: 20px 0; }
        .mult-box { border: 4px solid #8D6E63; background: #fff3e0; border-radius: 15px; padding: 15px; min-width: 120px; min-height: 100px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; }
        .mult-box::after { content: 'Box'; font-size: 0.8rem; position: absolute; bottom: -22px; color: #888; font-weight: bold; }
        .emoji-item { font-size: 2rem; margin: 2px; animation: popIn 0.3s; }
        .pile-area { min-height: 100px; padding: 20px; border: 3px dashed #ddd; border-radius: 15px; margin-bottom: 20px; background: #fafafa; }
        .baskets-stage { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px; }
        .recipient-container { display: flex; flex-direction: column; align-items: center; width: 130px; position: relative; }
        .recipient-avatar { font-size: 4rem; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.2)); margin-bottom: -15px; z-index: 2;}
        .recipient-box { width: 100%; min-height: 80px; border: 3px solid #ccc; border-top: none; border-radius: 0 0 15px 15px; background: #f9f9f9; display: flex; flex-wrap: wrap; justify-content: center; padding: 20px 5px 5px 5px; }
        .recipient-box.filled { background: #fffde7; border-color: var(--accent); }
        .shape-stage { height: 280px; display: flex; align-items: center; justify-content: center; position: relative; border: 2px solid #eee; border-radius: 15px; margin-top: 20px; background: #fff;}
        .s-rect { width: 200px; height: 120px; background: var(--accent); border: 5px solid var(--dark); position: relative; transition: border-color 0.3s; }
        .s-circle { width: 150px; height: 150px; background: var(--primary); border: 5px solid var(--dark); border-radius: 50%; position: relative; transition: border-color 0.3s; }
        
        /* Shape Label Styles (Corners/Angles) */
        .vertex-dot { width: 18px; height: 18px; background: red; border-radius: 50%; position: absolute; box-shadow: 0 0 0 2px white; animation: pulse 1s infinite; display: none; z-index: 10; }
        .v-label { position: absolute; font-weight: bold; font-size: 1.2rem; color: #d32f2f; background: rgba(255,255,255,0.8); padding: 0 4px; border-radius: 4px; z-index: 11; }
        .a-label { position: absolute; font-size: 0.9rem; color: blue; font-weight: bold; z-index: 10; white-space: nowrap; }

        .walker-track { position: relative; height: 60px; border-bottom: 4px solid #333; margin: 50px 20px; }
        .walker-dot { width: 30px; height: 30px; background: var(--secondary); border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3); position: absolute; left: 50%; top: -15px; transition: left 1s; transform: translateX(-50%); z-index: 5; }
        .walker-tick { position: absolute; top: 0; width: 1px; height: 10px; background: #555; }
        .walker-num { position: absolute; top: 20px; transform: translateX(-50%); font-size: 0.8rem; color: #555; }
        .graph-board { width: 400px; height: 400px; margin: 0 auto; background-color: #fff; background-image: linear-gradient(#ddd 1px, transparent 1px), linear-gradient(90deg, #ddd 1px, transparent 1px); background-size: 20px 20px; background-position: center; border: 2px solid #333; position: relative; cursor: crosshair; }
        .axis-x { position: absolute; top: 200px; left: 0; width: 100%; height: 2px; background: #333; }
        .axis-y { position: absolute; left: 200px; top: 0; height: 100%; width: 2px; background: #333; }
        .plot-point { width: 10px; height: 10px; background: red; border-radius: 50%; position: absolute; transform: translate(-50%, -50%); border: 1px solid white; pointer-events: none; display: none; }
        .scale-label { position: absolute; font-size: 9px; color: #555; pointer-events: none; }
        .constructor-stage { height: 350px; border: 2px dashed #ccc; border-radius: 15px; margin-top: 20px; display: flex; align-items: center; justify-content: center; background-image: radial-gradient(#ddd 1px, transparent 1px); background-size: 20px 20px; position: relative; }
        .result-panel { background: #e0f7fa; border-left: 5px solid var(--secondary); padding: 15px; margin-top: 20px; text-align: left; border-radius: 5px; display: none; }
        .d-circle { border: 3px solid var(--primary); background: rgba(255, 107, 107, 0.2); border-radius: 50%; position: relative; transition: all 0.5s; box-sizing: border-box; }
        .d-square { border: 3px solid var(--accent); background: rgba(255, 230, 109, 0.2); position: relative; transition: all 0.5s; box-sizing: border-box; }
        .shape-label { position: absolute; font-size: 0.8rem; color: #111; background: rgba(255,255,255,0.9); padding: 2px 6px; border-radius: 4px; font-weight: bold; pointer-events: none; border: 1px solid #ccc; white-space: nowrap; z-index: 10; }
        .dim-line { position: absolute; background: #333; pointer-events: none; }
        .dim-line-dashed { position: absolute; border-top: 2px dashed #555; height: 0; pointer-events: none; }
        .shape-3d-stage { display: flex; justify-content: center; align-items: flex-end; height: 200px; gap: 40px; margin-top: 20px;}
        .s-cylinder { width: 80px; height: 120px; background: linear-gradient(to right, #ccc, #fff, #ccc); border-top: 1px solid #999; border-bottom: 1px solid #999; position: relative; border-radius: 5px; }
        .s-cylinder::before { content: ''; position: absolute; top: -10px; left: 0; width: 100%; height: 20px; background: #eee; border: 1px solid #999; border-radius: 50%; }
        .s-cylinder::after { content: ''; position: absolute; bottom: -10px; left: 0; width: 100%; height: 20px; background: #ccc; border: 1px solid #999; border-radius: 50%; }
        .s-sphere { width: 100px; height: 100px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #fff, #FF6B6B, #880000); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .s-cone-visual { width: 100px; height: 120px; background: conic-gradient(from 180deg at 50% 0%, #4ECDC4, #2a9d8f); clip-path: polygon(50% 0%, 0% 100%, 100% 100%); border-radius: 0 0 50% 50% / 0 0 15px 15px; }
        .scenario-box { background: #fff; border: 3px solid #ccc; border-radius: 20px; padding: 30px; margin: 20px auto; min-height: 250px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: inset 0 0 20px rgba(0,0,0,0.05); }
        .step-btn { margin: 10px; background: var(--dark); color: white; border: none; padding: 15px 25px; border-radius: 10px; cursor: pointer; font-size: 1.2rem; transition: background 0.2s; box-shadow: 0 4px 0 #555; }
        .step-btn:active { transform: translateY(4px); box-shadow: none; } .step-btn:hover { background: #555; }
        
        /* NEW STYLES FOR KG */
        .ba-container { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 40px 0; }
        .ba-box { width: 120px; height: 120px; border: 4px solid var(--dark); border-radius: 15px; display: flex; justify-content: center; align-items: center; font-size: 3.5rem; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); font-weight: bold; }
        .ba-missing { background: #fff8e1; color: var(--primary); border-style: dashed; }
        .order-container { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; margin: 30px 0; }
        .order-btn { width: 80px; height: 80px; font-size: 2rem; border-radius: 15px; border: 3px solid #ddd; background: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 0 #ccc; }
        .order-btn:hover { transform: translateY(-3px); }
        .order-btn.correct-order { background: #4ECDC4; color: white; border-color: #3aa8a0; box-shadow: 0 4px 0 #3aa8a0; transform: scale(1.1); pointer-events: none; }
        
        /* CLASS 8 POLYGON STYLES */
        .poly-stage { width: 100%; height: 350px; display: flex; justify-content: center; align-items: center; background: white; border: 2px solid #eee; border-radius: 15px; position: relative; margin-top: 15px; }
        .poly-info-box { background: #e0f2f1; padding: 10px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #4ECDC4; text-align: left;}
        
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }

        /* Responsive */
        @media (max-width: 768px) {
            .main-nav { display: none; }
            .site-header { justify-content: center; }
            .hero h1 { font-size: 2.2rem; }
            #user-profile-box { position: absolute; top: 75px; right: 10px; background: white; border: 2px solid var(--secondary); z-index: 5000; }
        }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card" id="login-card">
            <h2 class="login-title">Amica<span style="color:var(--secondary)">Soft</span></h2>
            <p class="login-subtitle">Please login to continue to class.</p>
            
            <div class="input-group">
                <label>User ID</label>
                <input type="text" id="login-id" class="login-input" placeholder="Enter User ID">
            </div>
            
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="login-pass" class="login-input" placeholder="Enter Password">
            </div>

            <button class="btn-login" onclick="attemptLogin()">LOGIN</button>
            <div id="login-msg" class="error-msg">Incorrect ID or Password</div>
        </div>
    </div>

    <nav class="site-header">
        <a href="#" class="brand-logo" onclick="showSection('home')">Amica<span>Soft</span></a>
        
        <div class="nav-right">
            <div class="main-nav">
                <a onclick="showSection('home')" class="nav-link">Home</a>
                <a onclick="showSection('about')" class="nav-link">About Us</a>
                <a onclick="showSection('modules')" class="nav-link btn-cta">Start Learning</a>
                <a onclick="showSection('contact')" class="nav-link">Contact</a>
            </div>

            <div id="user-profile-box">
                <div class="user-icon">üë§</div>
                <span id="display-username" class="user-name-text">User</span>
                <button onclick="logout()" class="btn-logout" title="Logout">‚èª</button>
            </div>
        </div>
    </nav>

    <div id="section-home" class="page-section active-section">
        <div class="hero">
            <h1>Amica Soft</h1>
            <div class="tagline">Practical Teaching. Conceptual Learning.</div>
            <div class="bridge-container">
                <div class="bridge-pillar"><span class="bridge-icon">üë®‚Äçüéì</span><div class="pillar-title">Students</div><div class="pillar-desc">Transitioning from rote memorization to deep conceptual understanding.</div></div>
                <div class="bridge-pillar bridge-center"><span class="bridge-icon">üåâ</span><div class="pillar-title">Amica Soft</div><div class="pillar-desc">The digital bridge connecting theory to practice.</div></div>
                <div class="bridge-pillar"><span class="bridge-icon">üë©‚Äçüè´</span><div class="pillar-title">Teachers</div><div class="pillar-desc">Empowered with visual tools for practical demonstration.</div></div>
            </div>
            <button onclick="showSection('modules')" class="btn-cta" style="font-size: 1.2rem; padding: 15px 35px; cursor: pointer;">Enter Classrooms</button>
        </div>
    </div>

    <div id="section-about" class="page-section">
        <div class="about-container">
            <div class="about-header"><h2>About Amica Soft</h2></div>
            <div class="about-content">
                <p>At <strong>Amica Soft</strong>, we are dedicated to bridging the gap between traditional education and modern digital comprehension. Our mission is to foster a learning environment where students‚Äîfrom Kindergarten through Higher Standards‚Äîcan transition from rote memorization to deep, <strong>conceptual understanding</strong>.</p>
                <h3>Empowering Educators</h3>
                <p>We recognize that teachers are the architects of the future. Therefore, the Amica Soft interface serves as a powerful instructional partner for educators. We provide teachers with the digital tools necessary to translate abstract theories into <strong>practical, visual demonstrations</strong>.</p>
                <div class="quote-box">Derived from the Latin word for "friend," <strong>Amica</strong> represents our commitment to being a reliable, supportive companion in the pursuit of knowledge for both students and teachers alike.</div>
            </div>
        </div>
    </div>

    <div id="section-contact" class="page-section">
        <div class="contact-card">
            <h2 style="color: var(--dark); margin-bottom: 30px;">Get in Touch</h2>
            <div class="contact-item"><div class="icon-circle">‚úâÔ∏è</div><div>roshin.rmj@gmail.com</div></div>
            <div class="contact-item"><div class="icon-circle">üìû</div><div>+91 8943004613</div></div>
            <div class="contact-item"><div class="icon-circle">üìç</div><div>Amica Soft Headquarters<br><span style="font-size: 0.9rem; color:#777">Kerala, India</span></div></div>
        </div>
    </div>

    <div id="section-modules" class="page-section" style="background: #f0f4f8;">
        <div id="app-interface">
            <div style="margin-bottom: 20px;"><h1 style="color: var(--dark);">üéì Smart Math World</h1><p>Interactive Syllabus for KG - Class 8</p></div>
            <nav class="app-nav">
                <button class="app-btn active" onclick="switchModule(0)">KG</button><button class="app-btn" onclick="switchModule(1)">Class 1</button><button class="app-btn" onclick="switchModule(2)">Class 2</button><button class="app-btn" onclick="switchModule(3)">Class 3</button><button class="app-btn" onclick="switchModule(5)">Class 5</button><button class="app-btn" onclick="switchModule(6)">Class 6</button><button class="app-btn" onclick="switchModule(7)">Class 7</button><button class="app-btn" onclick="switchModule(8)">Class 8</button>
            </nav>
            
            <div id="module-0" class="module-container active-module">
                <div class="score-panel"><span class="score-text">üìù Test Score:</span><span class="score-val" id="score-0">0 / 0</span><button class="btn-reset" onclick="resetScore(0)">Start Test</button></div>
                <h2 class="module-title">Kindergarten</h2>
                
                <div class="controls">
                    <button class="app-btn active" id="btn-c0-count" onclick="c0_switchMode('count')">Counting</button>
                    <button class="app-btn" id="btn-c0-ba" onclick="c0_switchMode('ba')">Before & After</button>
                    <button class="app-btn" id="btn-c0-order" onclick="c0_switchMode('order')">Ordering</button>
                </div>

                <div id="c0-mode-count">
                    <div id="c0-instruction" class="story-text" style="font-size: 1.5rem;">Let's count the toys! üß∏</div>
                    <div class="kg-grid" id="c0-visuals"></div>
                    <div class="kg-options" id="c0-options"></div>
                    <div id="c0-feedback" class="feedback"></div>
                    <div class="controls"><button class="btn-action btn-new" onclick="c0_generate()">Next Puzzle ‚û°Ô∏è</button></div>
                </div>

                <div id="c0-mode-ba" style="display:none;">
                    <div id="c0-ba-instruction" class="story-text" style="font-size: 1.5rem;">What comes before?</div>
                    <div class="ba-container" id="c0-ba-stage">
                        </div>
                    <div class="kg-options" id="c0-ba-options"></div>
                    <div id="c0-ba-feedback" class="feedback"></div>
                    <div class="controls"><button class="btn-action btn-new" onclick="c0_generate_ba()">Next Number ‚û°Ô∏è</button></div>
                </div>

                <div id="c0-mode-order" style="display:none;">
                    <div id="c0-order-instruction" class="story-text" style="font-size: 1.4rem;">Arrange Small to Big ‚¨ÜÔ∏è</div>
                    <div id="c0-order-container" class="order-container"></div>
                    <div id="c0-order-feedback" class="feedback"></div>
                    <div class="controls"><button class="btn-action btn-new" onclick="c0_generate_order()">New Order ‚û°Ô∏è</button></div>
                </div>

            </div>
            
            <div id="module-1" class="module-container"><div class="score-panel"><span class="score-text">üìù Test Score:</span><span class="score-val" id="score-1">0 / 0</span><button class="btn-reset" onclick="resetScore(1)">Start Test</button></div><h2 class="module-title">Class 1: Fun with Apples</h2><div class="controls"><button class="btn-action" onclick="c1_setMode('add')" style="background:#FFD166; color:#333">Addition (+)</button><button class="btn-action" onclick="c1_setMode('sub')" style="background:#EF476F; color:white">Subtraction (-)</button></div><p id="c1-instruction" class="story-text">Count the apples!</p><div class="fruit-stage" id="c1-visuals"></div><div class="equation"><span id="c1-eq">?</span></div><input type="number" id="c1-input" class="game-input" placeholder="?"><button class="btn-action" onclick="c1_check()">Check</button><button class="btn-action btn-new" onclick="c1_generate()">New Problem</button><div id="c1-feedback" class="feedback"></div></div>
            
            <div id="module-2" class="module-container"><div class="score-panel"><span class="score-text">üìù Test Score:</span><span class="score-val" id="score-2">0 / 0</span><button class="btn-reset" onclick="resetScore(2)">Start Test</button></div><h2 class="module-title">Class 2: Multiplication Groups</h2><div id="c2-story" class="story-text">Loading story...</div><div id="c2-stage" class="grouping-stage"></div><div class="equation"><span id="c2-eq">?</span></div><div class="controls"><input type="number" id="c2-input" class="game-input" placeholder="?"><button class="btn-action" onclick="c2_check()">Check Answer</button><button class="btn-action btn-new" onclick="c2_generate()">New Story</button></div><div id="c2-feedback" class="feedback"></div></div>
            
            <div id="module-3" class="module-container"><div class="score-panel"><span class="score-text">üìù Test Score:</span><span class="score-val" id="score-3">0 / 0</span><button class="btn-reset" onclick="resetScore(3)">Start Test</button></div><h2 class="module-title">Class 3: Sharing with Friends</h2><div id="c3-story" class="story-text">Loading story...</div><div style="font-weight: bold; color: #777;">The Pile (Total)</div><div id="c3-pile" class="pile-area"></div><div style="font-size: 2em; color:#ccc;">‚¨áÔ∏è Drag/Share ‚¨áÔ∏è</div><div style="font-weight: bold; color: #777;">Friends:</div><div id="c3-stage" class="baskets-stage"></div><div class="controls" style="margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px;"><div class="equation" style="margin: 0 15px 0 0; font-size: 1.5rem;">How many per friend?</div><input type="number" id="c3-input" class="game-input" placeholder="?"><button class="btn-action" onclick="c3_check()">Check Answer</button><button class="btn-action btn-new" onclick="c3_generate()">New Story</button></div><div id="c3-feedback" class="feedback"></div></div>
            
            <div id="module-5" class="module-container"><h2 class="module-title">Class 5: Shape Explorer</h2><p class="story-text">Explore properties. No score for exploration.</p><div class="controls"><button class="btn-action" onclick="c5_show('rect')" style="background:var(--accent); color:#333">Rectangle</button><button class="btn-action" onclick="c5_show('circle')" style="background:var(--primary)">Circle</button><button class="btn-action" onclick="c5_show('tri')" style="background:var(--secondary)">Triangle</button></div><div class="shape-stage"><div id="c5-shape-area"></div></div><div id="c5-info" class="story-text">Select a shape above...</div><div class="controls"><button class="btn-action" onclick="c5_highlight('corners')">Show Corners</button><button class="btn-action" onclick="c5_highlight('sides')" style="background: #FF9F1C;">Show Edges</button></div></div>
            
            <div id="module-6" class="module-container"><div class="score-panel"><span class="score-text">üìù Test Score:</span><span class="score-val" id="score-6">0 / 0</span><button class="btn-reset" onclick="resetScore(6)">Start Test</button></div><h2 class="module-title">Class 6: Integers & Graphs</h2><div class="controls"><button class="app-btn active" id="btn-c6-line" onclick="c6_switchMode('line')">Number Line</button><button class="app-btn" id="btn-c6-graph" onclick="c6_switchMode('graph')">Graph Quiz</button></div><div id="c6-mode-walker"><p class="story-text">Integers: Walk Left for Negative (-), Right for Positive (+).</p><div class="walker-track" id="c6-walker-track"><div id="c6-walker" class="walker-dot"></div></div><div class="controls"><label>Move to: </label><input type="number" id="c6-input" class="game-input" placeholder="-5"><button class="btn-action" onclick="c6_move()">Walk</button></div><div id="c6-feedback" class="feedback"></div></div><div id="c6-mode-graph" style="display:none;"><p id="c6-graph-instruction" class="story-text" style="font-weight:bold; color: var(--dark);">Tap the Grid at (2, 3)</p><div class="graph-board" onclick="c6_plotClick(event)" id="c6-board"><div class="axis-x"></div><div class="axis-y"></div><div id="c6-plot-dot" class="plot-point"></div></div><div id="c6-graph-feedback" class="feedback"></div><button class="btn-action btn-new" onclick="c6_newGraphProblem()">New Point</button></div></div>
            
            <div id="module-7" class="module-container"><h2 class="module-title">Class 7: Shape Constructor</h2><p class="story-text">Constructor Tool (Ungraded Practice)</p><div class="controls"><button class="app-btn active" id="btn-c7-circle" onclick="c7_setShapeMode('circle')">Circle</button><button class="app-btn" id="btn-c7-square" onclick="c7_setShapeMode('square')">Square</button><button class="app-btn" id="btn-c7-tri" onclick="c7_setShapeMode('tri')">Eq. Triangle</button></div><div class="controls" style="background: #fff3e0; padding: 15px; border-radius: 10px;"><label id="c7-label">Radius (cm): </label><input type="number" id="c7-dim" class="game-input" min="1" max="6" value="3" style="width: 80px;"><button class="btn-action" onclick="c7_construct()">Draw & Calc</button></div><div id="c7-stage" class="constructor-stage"><span style="color:#aaa;">Shape will appear here...</span></div><div id="c7-results" class="result-panel"><h3>Calculated Properties:</h3><div id="c7-calc-content"></div></div></div>
            
            <div id="module-8" class="module-container">
                <div class="score-panel"><span class="score-text">üìù Test Score:</span><span class="score-val" id="score-8">0 / 0</span><button class="btn-reset" onclick="resetScore(8)">Start Test</button></div>
                <h2 class="module-title">Class 8: Algebra & Geometry</h2>
                
                <div class="controls">
                    <button class="app-btn active" id="btn-c8-alg" onclick="c8_switchTab('alg')">Algebra Scenarios</button>
                    <button class="app-btn" id="btn-c8-poly" onclick="c8_switchTab('poly')">Polygons & Area</button>
                    <button class="app-btn" id="btn-c8-solid" onclick="c8_switchTab('solid')">3D Shapes</button>
                </div>

                <div id="c8-tab-alg">
                    <div class="controls"><button class="app-btn" id="btn-c8-taxi" onclick="c8_setAlgMode('taxi')">Taxi Ride</button><button class="app-btn" id="btn-c8-age" onclick="c8_setAlgMode('age')">Age Riddle</button></div>
                    <div class="scenario-box" id="c8-scenario-box">
                        <div class="alg-stage" id="c8-alg-stage"></div>
                        <div class="controls" id="c8-controls" style="margin-top:20px;"></div>
                    </div>
                    <div class="controls" style="margin-top:20px;"><button class="btn-action btn-new" onclick="c8_generateProblem()">New Scenario</button></div>
                    <div id="c8-feedback" class="feedback">Read the story and solve!</div>
                </div>

                <div id="c8-tab-poly" style="display:none;">
                    <div class="controls">
                        <button class="app-btn" id="btn-c8-p-quad" onclick="c8_setPolyMode(4)">Quadrilateral</button>
                        <button class="app-btn" id="btn-c8-p-pent" onclick="c8_setPolyMode(5)">Pentagon</button>
                        <button class="app-btn" id="btn-c8-p-hex" onclick="c8_setPolyMode(6)">Hexagon</button>
                        <button class="app-btn" id="btn-c8-p-hept" onclick="c8_setPolyMode(7)">Heptagon</button>
                        <button class="app-btn" id="btn-c8-p-oct" onclick="c8_setPolyMode(8)">Octagon</button>
                    </div>
                    
                    <div class="poly-info-box" id="c8-poly-info">
                        Select a shape above to see how we calculate its area.
                    </div>

                    <div class="poly-stage" id="c8-poly-stage">
                        <span style="color:#aaa">Geometry Board</span>
                    </div>

                    <div id="c8-poly-quiz-section" style="display:none; margin-top:20px; border-top: 2px dashed #ddd; padding-top:20px;">
                        <p class="story-text" style="font-weight: bold;" id="c8-poly-question">Calculate the area:</p>
                        <div class="controls">
                            <input type="number" id="c8-poly-input" class="game-input" placeholder="Area">
                            <button class="btn-action" onclick="c8_checkPoly()">Check</button>
                            <button class="btn-action btn-new" onclick="c8_generatePolyQuiz()">New Numbers</button>
                        </div>
                        <div id="c8-poly-feedback" class="feedback"></div>
                    </div>
                </div>

                <div id="c8-tab-solid" style="display:none;">
                    <p class="story-text">Solid Shapes have Volume (3 Dimensions).</p>
                    <div class="shape-3d-stage">
                        <div style="text-align:center;"><div class="s-cylinder"></div><p>Cylinder</p></div>
                        <div style="text-align:center;"><div class="s-cone-visual"></div><p>Cone</p></div>
                        <div style="text-align:center;"><div class="s-sphere"></div><p>Sphere</p></div>
                    </div>
                </div>
            </div>

            <div class="brand-footer">Amanda & Michael's Amica Soft ¬© 2025</div>
        </div>
    </div>

    <script>
        /* --- LOGIN & SESSION LOGIC --- */
        function attemptLogin() {
            const idInput = document.getElementById('login-id');
            const passInput = document.getElementById('login-pass');
            const overlay = document.getElementById('login-overlay');
            const msg = document.getElementById('login-msg');
            const card = document.getElementById('login-card');
            const profileBox = document.getElementById('user-profile-box');
            const userNameDisplay = document.getElementById('display-username');

            // Hardcoded Credentials
            if (idInput.value.trim() === "Amanda" && passInput.value === "Michael") {
                // SUCCESS
                // 1. Set the user name in the header
                userNameDisplay.innerText = idInput.value;
                
                // 2. Show the profile box
                profileBox.style.display = 'flex';

                // 3. Hide the login overlay
                overlay.style.opacity = '0';
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 500);

            } else {
                // FAILURE
                msg.style.display = 'block';
                card.classList.add('shake-anim');
                setTimeout(() => { card.classList.remove('shake-anim'); }, 300);
            }
        }

        function logout() {
            // 1. Hide the profile box
            document.getElementById('user-profile-box').style.display = 'none';

            // 2. Clear inputs
            document.getElementById('login-id').value = '';
            document.getElementById('login-pass').value = '';
            document.getElementById('login-msg').style.display = 'none';

            // 3. Show the login overlay
            const overlay = document.getElementById('login-overlay');
            overlay.style.display = 'flex';
            // Slight delay to allow display:flex to apply before changing opacity
            setTimeout(() => {
                overlay.style.opacity = '1';
            }, 10);
            
            // 4. Return to home section (optional UX choice)
            showSection('home');
        }

        // Allow "Enter" key to trigger login
        document.getElementById('login-pass').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') attemptLogin();
        });

        /* --- WEBSITE NAVIGATION LOGIC --- */
        function showSection(sectionId) {
            document.querySelectorAll('.page-section').forEach(el => { el.classList.remove('active-section'); });
            document.getElementById(`section-${sectionId}`).classList.add('active-section');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        /* --- AUDIO SYSTEM --- */
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            if (type === 'correct') {
                const now = audioCtx.currentTime;
                const osc1 = audioCtx.createOscillator(); const g1 = audioCtx.createGain();
                osc1.type = 'sine'; osc1.frequency.value = 523.25; 
                osc1.connect(g1); g1.connect(audioCtx.destination);
                osc1.start(now); g1.gain.exponentialRampToValueAtTime(0.00001, now + 0.5); osc1.stop(now + 0.5);
                setTimeout(() => {
                    const osc2 = audioCtx.createOscillator(); const g2 = audioCtx.createGain();
                    osc2.type = 'sine'; osc2.frequency.value = 659.25;
                    osc2.connect(g2); g2.connect(audioCtx.destination);
                    osc2.start(audioCtx.currentTime); g2.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.5); osc2.stop(audioCtx.currentTime + 0.5);
                }, 100);
            } else {
                osc.type = 'sawtooth'; osc.frequency.value = 150;
                osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.3);
                gainNode.gain.value = 0.1; gainNode.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        /* --- GAME LOGIC --- */
        let scores = { 0:{c:0,t:0,s:false}, 1:{c:0,t:0,s:false}, 2:{c:0,t:0,s:false}, 3:{c:0,t:0,s:false}, 6:{c:0,t:0,s:false}, 8:{c:0,t:0,s:false} };
        function prepNewScore(modId) { if(scores[modId]) { scores[modId].s = false; scores[modId].t++; updateScoreUI(modId); } }
        function scoreWin(modId) { if(scores[modId] && !scores[modId].s) { scores[modId].c++; scores[modId].s = true; updateScoreUI(modId); } }
        function resetScore(modId) { 
            if(scores[modId]) { scores[modId].c = 0; scores[modId].t = 1; scores[modId].s = false; updateScoreUI(modId); 
            if(modId===0) { if(c0_mode==='count') c0_generate(true); else if(c0_mode==='ba') c0_generate_ba(true); else c0_generate_order(true); }
            if(modId===1) c1_generate(true); if(modId===2) c2_generate(true); if(modId===3) c3_generate(true); if(modId===6) c6_newGraphProblem(true); if(modId===8) { 
                if(c8_tab==='poly') c8_generatePolyQuiz(true); else c8_generateProblem(true); 
            }} 
        }
        function updateScoreUI(id) { const el = document.getElementById(`score-${id}`); if(el) el.innerText = `${scores[id].c} / ${scores[id].t}`; }
        
        function switchModule(id) { 
            document.querySelectorAll('.module-container').forEach(el => el.classList.remove('active-module')); 
            document.getElementById(`module-${id}`).classList.add('active-module'); 
            document.querySelectorAll('.app-nav .app-btn').forEach(btn => btn.classList.remove('active')); 
            event.currentTarget.classList.add('active'); // Fixed event targeting
            
            if(id===0) { c0_switchMode('count'); }
            if(id===1 && scores[1].t===0) c1_generate(); 
            if(id===2 && scores[2].t===0) c2_generate(); 
            if(id===3 && scores[3].t===0) c3_generate(); 
            if(id===6) { c6_switchMode('line'); if(scores[6].t===0) c6_newGraphProblem(); } 
            if(id===7) c7_setShapeMode('circle'); 
            if(id===8 && scores[8].t===0) c8_setAlgMode('taxi'); 
        }

        /* --- MODULE 0: KINDERGARTEN (UPDATED) --- */
        let c0_mode = 'count';
        let c0_ans = 0;
        let c0_ba_target = 0;
        let c0_ba_isBefore = true;
        let c0_order_list = [];
        let c0_order_sorted = [];
        let c0_order_idx = 0;

        const c0_items=[{icon:'üß∏',name:'Teddy Bears'},{icon:'üöó',name:'Cars'},{icon:'üå∏',name:'Flowers'},{icon:'üçé',name:'Apples'},{icon:'üç≠',name:'Lollipops'},{icon:'ü¶Ü',name:'Ducks'},{icon:'‚≠ê',name:'Stars'}];

        function c0_switchMode(mode) {
            c0_mode = mode;
            ['count', 'ba', 'order'].forEach(m => {
                document.getElementById(`c0-mode-${m}`).style.display = (m === mode) ? 'block' : 'none';
                document.getElementById(`btn-c0-${m}`).classList.toggle('active', m === mode);
            });
            // Auto start the selected game
            if(mode === 'count') c0_generate();
            if(mode === 'ba') c0_generate_ba();
            if(mode === 'order') c0_generate_order();
        }

        // 1. COUNTING LOGIC
        function c0_generate(skip){ 
            if(!skip) prepNewScore(0); 
            const item=c0_items[Math.floor(Math.random()*c0_items.length)]; 
            const count=Math.floor(Math.random()*9)+1; 
            c0_ans=count; 
            document.getElementById('c0-instruction').innerText=`Count the ${item.name} (${item.icon})!`; 
            document.getElementById('c0-feedback').innerText=""; 
            document.getElementById('c0-feedback').className="feedback"; 
            let gridHTML=''; 
            for(let i=0;i<count;i++) gridHTML+=`<div class="kg-item" onclick="c0_wiggle(this)">${item.icon}</div>`; 
            document.getElementById('c0-visuals').innerHTML=gridHTML; 
            let btnHTML=''; 
            for(let i=1;i<=10;i++) btnHTML+=`<button class="kg-btn" onclick="c0_check(this, ${i})">${i}</button>`; 
            document.getElementById('c0-options').innerHTML=btnHTML; 
        } 
        function c0_wiggle(el){ el.style.transform="scale(1.3) rotate(10deg)"; setTimeout(()=>el.style.transform="scale(1) rotate(0deg)",200); } 
        function c0_check(btn,val){ 
            const fb=document.getElementById('c0-feedback'); 
            document.querySelectorAll('.kg-btn').forEach(b=>{b.classList.remove('correct-choice','wrong-choice');b.disabled=false;}); 
            if(val===c0_ans){ 
                fb.innerText="Yay! Good Job! üåüüéà"; fb.className="feedback correct"; 
                btn.classList.add('correct-choice'); 
                document.querySelectorAll('.kg-item').forEach((el,index)=>{setTimeout(()=>el.style.transform="scale(1.5)",index*100);}); 
                playSound('correct'); scoreWin(0); 
            }else{ 
                fb.innerText="Oops! Count again. ü§î"; fb.className="feedback wrong"; 
                btn.classList.add('wrong-choice'); playSound('wrong'); 
            } 
        }

        // 2. BEFORE & AFTER LOGIC
        function c0_generate_ba(skip) {
            if(!skip) prepNewScore(0);
            const stage = document.getElementById('c0-ba-stage');
            const fb = document.getElementById('c0-ba-feedback');
            const opts = document.getElementById('c0-ba-options');
            fb.innerText = ""; fb.className = "feedback";
            
            // Random number 2 to 99
            let num = Math.floor(Math.random() * 98) + 2;
            c0_ba_isBefore = Math.random() > 0.5;
            
            let displayHTML = '';
            let instruction = '';
            let correctVal = 0;

            if(c0_ba_isBefore) {
                // Question: [ ? ] [ num ]
                correctVal = num - 1;
                instruction = `What number comes BEFORE ${num}?`;
                displayHTML = `<div class="ba-box ba-missing">?</div><div class="ba-box">${num}</div>`;
            } else {
                // Question: [ num ] [ ? ]
                correctVal = num + 1;
                instruction = `What number comes AFTER ${num}?`;
                displayHTML = `<div class="ba-box">${num}</div><div class="ba-box ba-missing">?</div>`;
            }

            document.getElementById('c0-ba-instruction').innerText = instruction;
            stage.innerHTML = displayHTML;
            c0_ba_target = correctVal;

            // Generate Options: Correct + 2 random distractors
            let optionsArr = [correctVal];
            while(optionsArr.length < 3) {
                let r = correctVal + Math.floor(Math.random() * 10) - 5;
                if(r > 0 && r < 101 && !optionsArr.includes(r)) optionsArr.push(r);
            }
            // Shuffle options
            optionsArr.sort(() => Math.random() - 0.5);

            let btnHTML = '';
            optionsArr.forEach(opt => {
                btnHTML += `<button class="kg-btn" style="width:80px; height:80px; font-size:2rem;" onclick="c0_check_ba(this, ${opt})">${opt}</button>`;
            });
            opts.innerHTML = btnHTML;
        }

        function c0_check_ba(btn, val) {
            const fb = document.getElementById('c0-ba-feedback');
            if(val === c0_ba_target) {
                fb.innerText = "Correct! You got it! üåü";
                fb.className = "feedback correct";
                btn.classList.add('correct-choice');
                
                // Reveal the number in the box
                const missingBox = document.querySelector('.ba-missing');
                missingBox.innerText = val;
                missingBox.style.color = 'var(--dark)';
                missingBox.style.background = '#4ECDC4';
                missingBox.style.borderStyle = 'solid';
                
                playSound('correct'); scoreWin(0);
            } else {
                fb.innerText = "Try again!";
                fb.className = "feedback wrong";
                btn.classList.add('wrong-choice');
                playSound('wrong');
            }
        }

        // 3. ORDERING LOGIC
        function c0_generate_order(skip) {
            if(!skip) prepNewScore(0);
            const container = document.getElementById('c0-order-container');
            const fb = document.getElementById('c0-order-feedback');
            const instr = document.getElementById('c0-order-instruction');
            fb.innerText = ""; fb.className = "feedback";
            
            // Pick 4 unique random numbers
            let nums = new Set();
            while(nums.size < 4) nums.add(Math.floor(Math.random() * 99) + 1);
            let arr = Array.from(nums);

            // Decide Ascending or Descending
            let isAsc = Math.random() > 0.5;
            instr.innerText = isAsc ? "Tap from Smallest to Biggest üìà" : "Tap from Biggest to Smallest üìâ";

            // Store sorted answer key
            c0_order_sorted = [...arr].sort((a,b) => isAsc ? a-b : b-a);
            c0_order_list = arr; // Current shuffled visual state
            c0_order_idx = 0; // Tracking progress

            // Render buttons (Shuffled initially, naturally from Set)
            let h = '';
            arr.forEach(n => {
                h += `<button class="order-btn" onclick="c0_check_order(this, ${n})">${n}</button>`;
            });
            container.innerHTML = h;
        }

        function c0_check_order(btn, val) {
            const fb = document.getElementById('c0-order-feedback');
            // Check if clicked value matches the next expected value in sorted array
            if(val === c0_order_sorted[c0_order_idx]) {
                // Correct
                btn.classList.add('correct-order');
                c0_order_idx++;
                playSound('correct');
                
                if(c0_order_idx === 4) {
                    fb.innerText = "Perfect Sequence! üéâ";
                    fb.className = "feedback correct";
                    scoreWin(0);
                }
            } else {
                // Wrong
                btn.classList.add('shake-anim');
                setTimeout(() => btn.classList.remove('shake-anim'), 400);
                fb.innerText = "Oops! Not that one.";
                fb.className = "feedback wrong";
                playSound('wrong');
            }
        }

        /* --- C1 --- */ 
        let c1_mode='add', c1_ans; function c1_setMode(m){c1_mode=m;c1_generate();} function c1_generate(skip){ if(!skip) prepNewScore(1); let s=document.getElementById('c1-visuals'); document.getElementById('c1-feedback').innerText=''; document.getElementById('c1-input').value=''; if(c1_mode==='add'){ let n1=Math.floor(Math.random()*5)+1, n2=Math.floor(Math.random()*5)+1; c1_ans=n1+n2; document.getElementById('c1-eq').innerText=`${n1} + ${n2} = ?`; s.innerHTML=getApples(n1)+' <span style="font-size:3rem; margin:0 10px;">+</span> '+getApples(n2); document.getElementById('c1-instruction').innerText="Count all apples together!"; } else { let n1=Math.floor(Math.random()*5)+4, n2=Math.floor(Math.random()*3)+1; if(n1<=n2) n1=n2+2; c1_ans=n1-n2; document.getElementById('c1-eq').innerText=`${n1} - ${n2} = ?`; let h=''; for(let i=0;i<n1;i++) h+=(i>=(n1-n2))?`<div class="apple eaten"><div class="cross-line"></div></div>`:`<div class="apple"></div>`; s.innerHTML=h; document.getElementById('c1-instruction').innerText=`You have ${n1} apples. Take away ${n2}.`; } } function getApples(n){let h='';for(let i=0;i<n;i++)h+='<div class="apple"></div>';return `<div style="display:inline-block">${h}</div>`;} function c1_check(){ let u=parseInt(document.getElementById('c1-input').value),f=document.getElementById('c1-feedback'); if(u===c1_ans){ f.innerText="Correct! üéâ";f.className="feedback correct"; playSound('correct'); scoreWin(1); }else{ f.innerText="Try again ‚ùå";f.className="feedback wrong"; playSound('wrong'); } }
        /* C2 */ let c2_ans=0; const c2_themes=[{item:'üçé',container:'Boxes',name:'Apples'},{item:'üç™',container:'Jars',name:'Cookies'}]; function c2_generate(skip){ if(!skip) prepNewScore(2); const t=c2_themes[Math.floor(Math.random()*2)]; let b=Math.floor(Math.random()*3)+2, i=Math.floor(Math.random()*4)+2; c2_ans=b*i; document.getElementById('c2-input').value=''; document.getElementById('c2-feedback').innerText=''; document.getElementById('c2-story').innerText=`${b} ${t.container}. Each has ${i} ${t.name}. Total?`; document.getElementById('c2-eq').innerText=`${b} √ó ${i} = ?`; const s=document.getElementById('c2-stage'); s.innerHTML=''; for(let k=0;k<b;k++){ let d=document.createElement('div');d.className='mult-box'; for(let j=0;j<i;j++){let sp=document.createElement('span');sp.className='emoji-item';sp.innerText=t.item;d.appendChild(sp);} s.appendChild(d); } } function c2_check(){ let u=parseInt(document.getElementById('c2-input').value),f=document.getElementById('c2-feedback'); if(u===c2_ans){f.innerText="Correct! üåü";f.className="feedback correct"; playSound('correct'); scoreWin(2);}else{f.innerText="Count carefully!";f.className="feedback wrong"; playSound('wrong');} }
        /* C3 */ let c3_ans=0,c3_gr=0,c3_t={}; const c3_ts=[{item:'üçå',group:'Monkeys',icon:'üêµ'},{item:'üç¨',group:'Kids',icon:'üßí'}]; function c3_generate(skip){ if(!skip) prepNewScore(3); c3_t=c3_ts[Math.floor(Math.random()*2)]; c3_ans=Math.floor(Math.random()*3)+2; c3_gr=Math.floor(Math.random()*3)+2; let tot=c3_ans*c3_gr; document.getElementById('c3-input').value=''; document.getElementById('c3-feedback').innerText=''; document.getElementById('c3-story').innerText=`Share ${tot} ${c3_t.item} among ${c3_gr} ${c3_t.group}.`; let p=''; for(let i=0;i<tot;i++)p+=`<span class="emoji-item">${c3_t.item}</span>`; document.getElementById('c3-pile').innerHTML=p; const s=document.getElementById('c3-stage'); s.innerHTML=''; for(let i=0;i<c3_gr;i++){ let c=document.createElement('div');c.className='recipient-container'; let a=document.createElement('div');a.className='recipient-avatar';a.innerText=c3_t.icon; a.style.filter=`hue-rotate(${i*60}deg)`; let b=document.createElement('div');b.className='recipient-box';b.id=`c3-box-${i}`; c.appendChild(a);c.appendChild(b);s.appendChild(c); } } function c3_check(){ let u=parseInt(document.getElementById('c3-input').value),f=document.getElementById('c3-feedback'); if(u===c3_ans){ f.innerText="Correct! ‚úÖ";f.className="feedback correct"; playSound('correct'); scoreWin(3); document.getElementById('c3-pile').innerHTML=''; for(let i=0;i<c3_gr;i++){ let b=document.getElementById(`c3-box-${i}`);b.classList.add('filled'); for(let j=0;j<c3_ans;j++){let it=document.createElement('span');it.className='emoji-item';it.innerText=c3_t.item;b.appendChild(it);} } }else{f.innerText="Not quite. Try sharing again.";f.className="feedback wrong"; playSound('wrong');} }
        /* C5 */ 
        let c5_curr=''; 
        function c5_show(s){ 
            c5_curr=s; 
            const st=document.getElementById('c5-shape-area'), inf=document.getElementById('c5-info'); 
            st.innerHTML=''; 
            
            if(s==='rect'){
                st.innerHTML=`<div class="s-rect shape-display">
                    <span class="v-label" style="top:-25px; left:-15px;">A</span>
                    <span class="v-label" style="top:-25px; right:-15px;">B</span>
                    <span class="v-label" style="bottom:-25px; left:-15px;">C</span>
                    <span class="v-label" style="bottom:-25px; right:-15px;">D</span>
                    <div class="vertex-dot" style="top:-9px;left:-9px;"></div><div class="vertex-dot" style="top:-9px;right:-9px;"></div><div class="vertex-dot" style="bottom:-9px;left:-9px;"></div><div class="vertex-dot" style="bottom:-9px;right:-9px;"></div></div>`;
                inf.innerText="Rectangle: 4 Sides, 4 Corners (90¬∞).";
            } 
            else if(s==='circle'){
                st.innerHTML=`<div class="s-circle shape-display" style="border-width:5px;"></div>`;
                inf.innerText="Circle: 0 Corners, 1 Curved Edge.";
            } 
            else if(s==='tri'){
                st.innerHTML=`<div style="position:relative; width:200px; height:170px;">
                    <span class="v-label" style="top:-20px; left:85px;">A</span>
                    <span class="v-label" style="bottom:-20px; left:-10px;">B</span>
                    <span class="v-label" style="bottom:-20px; right:-10px;">C</span>
                    <svg height="170" width="200"><polygon points="100,5 195,165 5,165" style="fill:var(--secondary);stroke:var(--dark);stroke-width:5" /></svg>
                    <div class="vertex-dot" style="top:-5px; left:90px;"></div><div class="vertex-dot" style="bottom:-5px; left:-5px;"></div><div class="vertex-dot" style="bottom:-5px; right:-5px;"></div></div>`;
                inf.innerText="Triangle: 3 Sides, 3 Corners.";
            } 
        } 
        function c5_highlight(t){ 
            if(!c5_curr)return alert("Select shape first"); 
            if(t==='corners'){
                document.querySelectorAll('.vertex-dot').forEach(e=>e.style.display='block');
                if(c5_curr==='circle') alert("Circles have no corners!");
            } 
            if(t==='sides'){ 
                const e=document.querySelector('.shape-display'); 
                if(c5_curr!=='tri'){
                    e.style.borderColor="#007BFF";e.style.boxShadow="0 0 15px #007BFF";
                    setTimeout(()=>{e.style.borderColor="";e.style.boxShadow="none";},1500);
                } else {
                    const p=document.querySelector('polygon');p.style.stroke="#007BFF";p.style.strokeWidth="10";
                    setTimeout(()=>{p.style.stroke="var(--dark)";p.style.strokeWidth="5";},1500);
                } 
            } 
        }
        /* C6 */ function c6_switchMode(m){ document.getElementById('c6-mode-walker').style.display=m==='line'?'block':'none'; document.getElementById('c6-mode-graph').style.display=m==='graph'?'block':'none'; document.getElementById('btn-c6-line').classList.toggle('active',m==='line'); document.getElementById('btn-c6-graph').classList.toggle('active',m==='graph'); if(m==='line')c6_drawWalkerTicks(); if(m==='graph'){c6_drawGridLabels();if(scores[6].t===0)c6_newGraphProblem();} } function c6_move(){let v=parseInt(document.getElementById('c6-input').value);if(v>10)v=10;if(v<-10)v=-10;document.getElementById('c6-walker').style.left=(50+(v*4))+"%";} function c6_drawWalkerTicks(){ const track=document.getElementById('c6-walker-track'); if(track.querySelector('.walker-tick'))return; for(let i=-10;i<=10;i++){ let tick=document.createElement('div');tick.className='walker-tick';tick.style.left=(50+(i*4))+'%'; let num=document.createElement('div');num.className='walker-num';num.innerText=i;num.style.left=(50+(i*4))+'%'; if(i%5!==0 && i!==0)num.style.display='none'; track.appendChild(tick);track.appendChild(num); } } let c6_tx=0,c6_ty=0; function c6_drawGridLabels(){ const b=document.getElementById('c6-board'); if(b.querySelector('.scale-label'))return; for(let i=-10;i<=10;i++){ if(i===0)continue; if(i%2!==0)continue; let x=document.createElement('div');x.className='scale-label';x.innerText=i;x.style.left=(200+(i*20)-5)+'px';x.style.top='205px';b.appendChild(x); let y=document.createElement('div');y.className='scale-label';y.innerText=i;y.style.left='180px';y.style.top=(200-(i*20)-8)+'px';b.appendChild(y); } let o=document.createElement('div');o.className='scale-label';o.innerText='0';o.style.left='185px';o.style.top='205px';b.appendChild(o); } function c6_newGraphProblem(skip){ if(!skip) prepNewScore(6); c6_tx=Math.floor(Math.random()*19)-9; c6_ty=Math.floor(Math.random()*19)-9; document.getElementById('c6-graph-instruction').innerText=`Tap Grid at (${c6_tx}, ${c6_ty})`; document.getElementById('c6-plot-dot').style.display='none'; document.getElementById('c6-graph-feedback').innerText=''; } function c6_plotClick(e){ const b=e.currentTarget, r=b.getBoundingClientRect(); let gx=Math.round((e.clientX-r.left-200)/20), gy=Math.round(-(e.clientY-r.top-200)/20); const d=document.getElementById('c6-plot-dot'); d.style.display='block';d.style.left=(200+(gx*20))+'px';d.style.top=(200-(gy*20))+'px'; const f=document.getElementById('c6-graph-feedback'); if(gx===c6_tx && gy===c6_ty){ f.innerText="Correct! üéâ";f.className="feedback correct"; playSound('correct'); scoreWin(6); }else{ f.innerText=`You clicked (${gx}, ${gy}). Try again.`;f.className="feedback wrong"; playSound('wrong'); } }
        /* C7 */ 
        let c7_mode='circle'; const PX_CM=28; 
        function c7_setShapeMode(m){ c7_mode=m; ['circle','square','tri'].forEach(k=>document.getElementById(`btn-c7-${k}`).classList.remove('active')); document.getElementById(`btn-c7-${m}`).classList.add('active'); document.getElementById('c7-label').innerText=(m==='circle'?"Radius":"Side")+" (cm): "; document.getElementById('c7-stage').innerHTML='<span style="color:#aaa">Drawing area...</span>'; document.getElementById('c7-results').style.display='none'; } 
        function c7_construct(){ 
            const v=parseFloat(document.getElementById('c7-dim').value); 
            if(!v||v<=0||v>10)return alert("Enter value 1-10"); 
            const st=document.getElementById('c7-stage'); 
            st.innerHTML=''; 
            document.getElementById('c7-results').style.display='block'; 
            const res=document.getElementById('c7-calc-content'); 
            
            if(c7_mode==='circle'){ 
                let d=(v*2)*PX_CM; let a=(Math.PI*v*v).toFixed(2); let c=(2*Math.PI*v).toFixed(2); 
                let container=document.createElement('div'); 
                container.style.position='relative';container.style.width=d+'px';container.style.height=d+'px'; 
                let el=document.createElement('div');el.className='d-circle';el.style.width='100%';el.style.height='100%'; 
                let dLine=document.createElement('div');dLine.className='dim-line-dashed'; dLine.style.width='100%';dLine.style.top='50%';dLine.style.left='0'; 
                let rLine=document.createElement('div');rLine.className='dim-line'; rLine.style.height='50%';rLine.style.width='2px';rLine.style.left='50%';rLine.style.top='0';rLine.style.background='blue'; 
                let dLabel=document.createElement('div');dLabel.className='shape-label'; dLabel.innerText=`d = ${v*2}cm`;dLabel.style.top='52%';dLabel.style.left='10%'; 
                let rLabel=document.createElement('div');rLabel.className='shape-label'; rLabel.innerText=`r = ${v}cm`;rLabel.style.top='20%';rLabel.style.left='52%'; 
                container.appendChild(el);container.appendChild(dLine);container.appendChild(rLine); container.appendChild(dLabel);container.appendChild(rLabel); 
                st.appendChild(container); 
                res.innerHTML=`<p>Area (œÄr¬≤): <b>${a} cm¬≤</b></p><p>Circumference (2œÄr): <b>${c} cm</b></p>`; 
            } else if(c7_mode==='square'){ 
                let s=v*PX_CM; let a=(v*v).toFixed(2); let p=(4*v).toFixed(2); 
                let el=document.createElement('div');el.className='d-square';el.style.width=s+'px';el.style.height=s+'px'; 
                let lTop=document.createElement('div');lTop.className='shape-label';lTop.innerText=`s = ${v}cm`;lTop.style.top='-25px';lTop.style.left='50%';lTop.style.transform='translateX(-50%)'; 
                
                // ADDED LABELS FOR SQUARE
                let vA=document.createElement('span');vA.className='v-label';vA.innerText='A';vA.style.top='-20px';vA.style.left='-20px';
                let vB=document.createElement('span');vB.className='v-label';vB.innerText='B';vB.style.top='-20px';vB.style.right='-20px';
                let vC=document.createElement('span');vC.className='v-label';vC.innerText='C';vC.style.bottom='-20px';vC.style.left='-20px';
                let vD=document.createElement('span');vD.className='v-label';vD.innerText='D';vD.style.bottom='-20px';vD.style.right='-20px';
                
                // ADDED ANGLES FOR SQUARE
                let angA=document.createElement('span');angA.className='a-label';angA.innerText='90¬∞';angA.style.top='5px';angA.style.left='5px';
                let angB=document.createElement('span');angB.className='a-label';angB.innerText='90¬∞';angB.style.top='5px';angB.style.right='5px';
                let angC=document.createElement('span');angC.className='a-label';angC.innerText='90¬∞';angC.style.bottom='5px';angC.style.left='5px';
                let angD=document.createElement('span');angD.className='a-label';angD.innerText='90¬∞';angD.style.bottom='5px';angD.style.right='5px';

                el.appendChild(lTop); 
                el.appendChild(vA);el.appendChild(vB);el.appendChild(vC);el.appendChild(vD);
                el.appendChild(angA);el.appendChild(angB);el.appendChild(angC);el.appendChild(angD);

                st.appendChild(el); 
                res.innerHTML=`<p>Area (s¬≤): <b>${a} cm¬≤</b></p><p>Perimeter (4s): <b>${p} cm</b></p>`; 
            } else { 
                let s=v*PX_CM; let h=s*(Math.sqrt(3)/2); let a=((Math.sqrt(3)/4)*v*v).toFixed(2); let p=(3*v).toFixed(2); 
                st.innerHTML=`<div style="position:relative; width:${s}px; height:${h}px">
                    <svg width="${s}" height="${h}" style="overflow:visible">
                        <polygon points="${s/2},0 ${s},${h} 0,${h}" style="fill:rgba(78,205,196,0.3);stroke:var(--dark);stroke-width:3"/>
                        <text x="${s*0.2}" y="${h/2}" fill="#333" font-weight="bold">${v}cm</text>
                    </svg>
                    <span class="v-label" style="top:-25px; left:50%; transform:translateX(-50%);">A</span>
                    <span class="v-label" style="bottom:-10px; right:-20px;">B</span>
                    <span class="v-label" style="bottom:-10px; left:-20px;">C</span>
                    <span class="a-label" style="top:10px; left:50%; transform:translateX(-50%); color:blue;">60¬∞</span>
                    <span class="a-label" style="bottom:5px; right:5px; color:blue;">60¬∞</span>
                    <span class="a-label" style="bottom:5px; left:5px; color:blue;">60¬∞</span>
                </div>`; 
                res.innerHTML=`<p>Area (‚àö3/4 s¬≤): <b>${a} cm¬≤</b></p><p>Perimeter (3s): <b>${p} cm</b></p>`; 
            } 
        }

        /* --- C8: ALGEBRA & GEOMETRY (UPDATED) --- */
        let c8_tab='alg';
        let c8_alg_mode='taxi', c8_curr_data={}, c8_step=1; 
        
        let c8_poly_mode = 5; // Default pentagon
        let c8_poly_quiz = { ans: 0 };
        
        function c8_switchTab(t){ 
            c8_tab = t;
            ['alg', 'solid', 'poly'].forEach(k => {
                document.getElementById(`c8-tab-${k}`).style.display = (k === t) ? 'block' : 'none';
                document.getElementById(`btn-c8-${k}`).classList.toggle('active', k === t);
            });
            if(t==='poly') c8_setPolyMode(5); 
        } 

        function c8_setAlgMode(mode){ c8_alg_mode=mode; document.getElementById('btn-c8-taxi').classList.toggle('active',mode==='taxi'); document.getElementById('btn-c8-age').classList.toggle('active',mode==='age'); c8_generateProblem(); } 
        
        function c8_generateProblem(skip){ if(!skip) prepNewScore(8); const stage=document.getElementById('c8-alg-stage'); const ctrl=document.getElementById('c8-controls'); const fb=document.getElementById('c8-feedback'); fb.innerText=""; fb.className="feedback"; c8_step=1; if(c8_alg_mode==='taxi'){ let r=Math.floor(Math.random()*4)*5+10; let b=Math.floor(Math.random()*5)*10+20; let x=Math.floor(Math.random()*8)+2; let y=(r*x)+b; c8_curr_data={type:'taxi',r:r,b:b,x:x,y:y}; stage.innerHTML=`<p class="story-text" style="margin:0 0 10px 0;"><b>üöï The Taxi Ride</b><br>Base Fare: ‚Çπ${b}<br>Rate: ‚Çπ${r} per km<br>Total Paid: ‚Çπ${y}</p><p class="equation" id="c8-eq">${r}x + ${b} = ${y}</p><p id="c8-prompt" style="color:#555"><b>Step 1:</b> Which operation comes first?</p>`; ctrl.innerHTML=`<button class="step-btn" onclick="c8_process(1, 'sub', ${b})">Subtract ${b}</button><button class="step-btn" onclick="c8_process(1, 'div', ${r})">Divide by ${r}</button>`; } else { let m=Math.floor(Math.random()*3)+2; let c=Math.floor(Math.random()*8)+2; let x=Math.floor(Math.random()*8)+5; let isSub=Math.random()>0.5; let y=isSub?(m*x)-c:(m*x)+c; c8_curr_data={type:'age',m:m,c:c,x:x,y:y,isSub:isSub}; let phrase=isSub?`minus ${c}`:`plus ${c}`; stage.innerHTML=`<p class="story-text" style="margin:0 0 10px 0;"><b>üë¥ Age Riddle</b><br>"${m} times my age ${phrase} is ${y}."</p><p class="equation" id="c8-eq">${m}x ${isSub?'-':'+'} ${c} = ${y}</p><p id="c8-prompt" style="color:#555"><b>Step 1:</b> Which operation comes first?</p>`; ctrl.innerHTML=`<button class="step-btn" onclick="c8_process(1, 'add', ${c})">Add ${c}</button><button class="step-btn" onclick="c8_process(1, 'sub', ${c})">Subtract ${c}</button>`; } } 
        function c8_process(stepAttempt,action,val){ const fb=document.getElementById('c8-feedback'); const d=c8_curr_data; const eq=document.getElementById('c8-eq'); const ctrl=document.getElementById('c8-controls'); const prompt=document.getElementById('c8-prompt'); if(c8_step===1){ let correct=false; if(d.type==='taxi'&&action==='sub')correct=true; if(d.type==='age'&&((d.isSub&&action==='add')||(!d.isSub&&action==='sub')))correct=true; if(correct){ fb.innerText="Correct! First we handle the constant."; fb.className="feedback correct"; playSound('correct'); if(d.type==='taxi')eq.innerText=`${d.r}x = ${d.y-d.b}`; else eq.innerText=`${d.m}x = ${d.m*d.x}`; c8_step=2; let coef=d.type==='taxi'?d.r:d.m; prompt.innerHTML="<b>Step 2:</b> Now isolate x."; setTimeout(()=>{ctrl.innerHTML=`<button class="step-btn" onclick="c8_process(2, 'div', ${coef})">Divide by ${coef}</button><button class="step-btn" onclick="c8_process(2, 'sub', ${coef})">Subtract ${coef}</button>`;},500); }else{ fb.innerText="Incorrect order. Try again."; fb.className="feedback wrong"; playSound('wrong'); } } else if(c8_step===2){ if(action==='div'){ fb.innerText=`üéâ Correct! x = ${d.x}. Puzzle Solved!`; fb.className="feedback correct"; eq.innerText=`x = ${d.x}`; ctrl.innerHTML=''; playSound('correct'); scoreWin(8); }else{ fb.innerText="Multiplication is undone by Division."; fb.className="feedback wrong"; playSound('wrong'); } } }

        /* --- CLASS 8 POLYGON LOGIC --- */
        function c8_setPolyMode(n) {
            c8_poly_mode = n;
            // Highlight buttons
            ['quad','pent','hex','hept','oct'].forEach(k => document.getElementById(`btn-c8-p-${k}`).classList.remove('active'));
            let key = (n===4)?'quad':(n===5)?'pent':(n===6)?'hex':(n===7)?'hept':'oct';
            document.getElementById(`btn-c8-p-${key}`).classList.add('active');

            // Set Info Text
            let info = document.getElementById('c8-poly-info');
            if(n === 4) {
                info.innerHTML = "<b>Quadrilateral Area:</b> Split into two triangles using a diagonal.<br>Area = <b>¬Ω √ó d √ó (h‚ÇÅ + h‚ÇÇ)</b>";
            } else {
                let name = (n===5)?'Pentagon':(n===6)?'Hexagon':(n===7)?'Heptagon':'Octagon';
                info.innerHTML = `<b>${name} Area:</b> Divide into ${n} equal triangles.<br>Area = ${n} √ó (¬Ω √ó side √ó apothem)<br><b>Area = ¬Ω √ó Perimeter √ó Apothem</b>`;
            }

            // Draw shape
            c8_drawPoly(n);
            
            // Start Quiz
            document.getElementById('c8-poly-quiz-section').style.display = 'block';
            c8_generatePolyQuiz(true); // Don't reset score on tab switch, just gen problem
        }

        function c8_drawPoly(n) {
            const container = document.getElementById('c8-poly-stage');
            // Using SVG for easier drawing
            let svgContent = '';
            
            if (n === 4) {
                // Draw General Quadrilateral split by diagonal
                // Points: (50,150), (250,50), (350,200), (150,300)
                // Diagonal: (50,150) to (350,200)
                // Heights dropping from (250,50) and (150,300) onto the diagonal line
                
                // Simplified visualization for clarity (Kite-like but general)
                // Diagonal horizontal for easier visual understanding
                svgContent = `
                    <svg width="400" height="300" viewBox="0 0 400 300">
                        <line x1="50" y1="150" x2="350" y2="150" stroke="#333" stroke-width="3" stroke-dasharray="5,5" />
                        <text x="200" y="145" text-anchor="middle" fill="#333" font-weight="bold">d</text>
                        
                        <polygon points="50,150 200,50 350,150" fill="rgba(78, 205, 196, 0.2)" stroke="#333" stroke-width="2"/>
                        <line x1="200" y1="50" x2="200" y2="150" stroke="red" stroke-width="2" />
                        <text x="210" y="100" fill="red" font-weight="bold">h‚ÇÅ</text>

                        <polygon points="50,150 220,280 350,150" fill="rgba(255, 107, 107, 0.2)" stroke="#333" stroke-width="2"/>
                        <line x1="220" y1="280" x2="220" y2="150" stroke="blue" stroke-width="2" />
                        <text x="230" y="220" fill="blue" font-weight="bold">h‚ÇÇ</text>
                    </svg>
                `;
            } else {
                // Regular Polygon Logic
                let cx = 200, cy = 150, r = 100;
                let pts = [];
                for(let i=0; i<n; i++) {
                    let angle = (i * 2 * Math.PI / n) - (Math.PI/2);
                    let x = cx + r * Math.cos(angle);
                    let y = cy + r * Math.sin(angle);
                    pts.push(`${x},${y}`);
                }
                let polyStr = pts.join(" ");

                // Central Lines (Triangulation)
                let lines = "";
                for(let i=0; i<n; i++) {
                     // Parse point back
                     let p = pts[i].split(',');
                     lines += `<line x1="${cx}" y1="${cy}" x2="${p[0]}" y2="${p[1]}" stroke="#ccc" stroke-width="1" />`;
                }

                // Apothem Line (from center to midpoint of first side)
                // First side is between pts[0] and pts[1]
                // Actually, let's just do it straight down or right for visual clarity
                // Let's take the bottom edge. For standard rotation -PI/2, bottom edge might vary.
                // Let's genericize: Draw apothem to the midpoint of index 0 and 1
                let p0 = pts[0].split(','), p1 = pts[1].split(',');
                let mx = (parseFloat(p0[0]) + parseFloat(p1[0]))/2;
                let my = (parseFloat(p0[1]) + parseFloat(p1[1]))/2;
                
                svgContent = `
                    <svg width="400" height="300">
                        <polygon points="${polyStr}" fill="rgba(255, 230, 109, 0.3)" stroke="#333" stroke-width="3"/>
                        ${lines}
                        <polygon points="${cx},${cy} ${p0[0]},${p0[1]} ${p1[0]},${p1[1]}" fill="rgba(255, 159, 28, 0.3)" />
                        <line x1="${cx}" y1="${cy}" x2="${mx}" y2="${my}" stroke="red" stroke-width="2" stroke-dasharray="4"/>
                        <text x="${(cx+mx)/2 + 10}" y="${(cy+my)/2}" fill="red" font-weight="bold">a</text>
                        <text x="${mx}" y="${my-10}" fill="#333" font-weight="bold">s</text>
                    </svg>
                `;
            }
            container.innerHTML = svgContent;
        }

        function c8_generatePolyQuiz(skip) {
            if(!skip) prepNewScore(8);
            
            // Clear previous feedback
            document.getElementById('c8-poly-input').value = '';
            document.getElementById('c8-poly-feedback').innerText = '';
            document.getElementById('c8-poly-feedback').className = 'feedback';

            let qText = "";
            let area = 0;

            if (c8_poly_mode === 4) {
                // Quadrilateral
                let d = Math.floor(Math.random()*10) + 10; // 10-20
                let h1 = Math.floor(Math.random()*5) + 3;
                let h2 = Math.floor(Math.random()*5) + 3;
                area = 0.5 * d * (h1 + h2);
                qText = `Quadrilateral: Diagonal d = ${d}, Offsets h‚ÇÅ = ${h1}, h‚ÇÇ = ${h2}`;
            } else {
                // Polygon
                let s = Math.floor(Math.random()*8) + 4; // side
                let a = Math.floor(Math.random()*5) + 3; // apothem (simplified integer for quiz)
                let n = c8_poly_mode;
                let perimeter = n * s;
                area = 0.5 * perimeter * a;
                let name = (n===5)?'Pentagon':(n===6)?'Hexagon':(n===7)?'Heptagon':'Octagon';
                qText = `${name}: Side = ${s}, Apothem = ${a}`;
            }

            c8_poly_quiz.ans = area;
            document.getElementById('c8-poly-question').innerHTML = qText + "<br>Calculate Total Area:";
        }

        function c8_checkPoly() {
            let userVal = parseFloat(document.getElementById('c8-poly-input').value);
            let fb = document.getElementById('c8-poly-feedback');
            
            if (Math.abs(userVal - c8_poly_quiz.ans) < 0.1) {
                fb.innerText = "Correct! üåü";
                fb.className = "feedback correct";
                playSound('correct');
                scoreWin(8);
            } else {
                fb.innerText = "Check your calculation.";
                fb.className = "feedback wrong";
                playSound('wrong');
            }
        }

        c1_generate();
    </script>
</body>
</html>
